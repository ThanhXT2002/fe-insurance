<app-breadcrumb-img [title]="title()" />

<div class="bg-gray-50">
  <div class="container-layer">
    @if (isLoading()) {
      <div class="loading-container">
        <div class="loading-spinner"></div>
        <p class="loading-text">Đang tải chính sách bảo mật...</p>
      </div>
    } @else {
      <!-- Main Content -->
      <div class="main-content">
        <div class="content-grid">
          <!-- Sidebar with TOC -->
          <div class="sidebar">
            <div class="sticky-toc">
              <div class="table-of-contents">
                <!-- Progress Bar -->
                <div class="progress-container">
                  <div class="progress-bar" id="progressBar"></div>
                </div>
                <h3 class="toc-title">Mục lục</h3>
                <ul class="toc-list">
                  @for (
                    section of sections();
                    track section.id;
                    let i = $index
                  ) {
                    <li>
                      <a [href]="'#' + section.id" class="toc-link">
                        {{ i + 1 }}. {{ section.heading }}
                      </a>
                    </li>
                  }
                </ul>
              </div>

              <!-- Download Button -->
              <div class="download-section">
                <button
                  (click)="downloadPdf()"
                  class="btn-download float-animation"
                  type="button"
                >
                  <svg
                    class="download-icon"
                    fill="none"
                    stroke="currentColor"
                    viewBox="0 0 24 24"
                  >
                    <path
                      stroke-linecap="round"
                      stroke-linejoin="round"
                      stroke-width="2"
                      d="M12 10v6m0 0l-3-3m3 3l3-3m2 8H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"
                    ></path>
                  </svg>
                  Tải PDF
                </button>
              </div>
            </div>
          </div>

          <!-- Content Area -->
          <div class="content-area">
            <div class="content-card">
              <!-- Header Info -->
              <div class="policy-header">
                <h1 class="policy-title reveal-text">{{ title() }}</h1>
                <p class="policy-subtitle reveal-text">{{ subtitle() }}</p>
                @if (lastUpdated()) {
                  <div class="last-updated reveal-text">
                    <p>Cập nhật lần cuối: {{ lastUpdated() }}</p>
                  </div>
                }
              </div>

              <!-- Policy Sections -->
              @for (section of sections(); track section.id; let i = $index) {
                <div [id]="section.id" class="policy-section">
                  <h2 class="section-heading reveal-text">
                    {{ i + 1 }}. {{ section.heading }}
                  </h2>

                  <div class="section-content">
                    @for (content of section.processedContent; track $index) {
                      @if (content.type === "paragraph") {
                        <p class="content-paragraph reveal-text">
                          {{ content.items[0] }}
                        </p>
                      } @else if (content.type === "list") {
                        <ul class="content-list stagger-list">
                          @for (item of content.items; track $index) {
                            <li class="reveal-text">{{ item }}</li>
                          }
                        </ul>
                      }
                    }
                  </div>
                </div>
              }
            </div>
          </div>
        </div>
      </div>
    }
  </div>
</div>
